{"file":"je-form.js","mappings":";;;AAAA,MAAM,SAAS,GAAG,kEAAkE;;MCQvEA,QAAM,iBAAAC,kBAAA,CAAA,MAAA,MAAA,SAAAC,CAAA,CAAA;;;;;;;;AACT,IAAA,GAAG,GAAG,IAAIC,uBAAY,EAAmB;AACzC,IAAA,GAAG;AAEF,IAAA,QAAQ;IAEjB,iBAAiB,GAAA;AACf,QAAA,IAAI,CAAC,GAAG,GAAG,IAAI,CAAC,GAAG,CAAC,IAAI,CAACC,oBAAS,CAAC,EAAE,IAAG;AACtC,YAAA,MAAM,GAAG,GAAGC,oBAAS,CAAC,EAAE,EAAE,SAAS,EAAE,EAAE,OAAO,EAAE,IAAI,EAAE,CAAC;AACvD,YAAA,OAAO,GAAG,CAAC,IAAI,CAACC,iBAAM,CAAC,GAAG,CAAC,IAAI,CAACC,uBAAY,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;AACtD,SAAC,CAAC,CAAC,CAAC,SAAS,CAAC,MAAM,IAAG;YACrB,MAAM,mBAAmB,GAAG,MAAM,CAAC,CAAC,CAAC,CAAC,MAAqB;YAC3D,IAAI,mBAAmB,IAAI,CAAC,mBAAmB,CAAC,OAAO,CAAC,QAAQ,CAAC;gBAC/D,mBAAmB,CAAC,KAAK,EAAE;AAC/B,SAAC,CAAC;;IAGJ,oBAAoB,GAAA;AAClB,QAAA,IAAI,CAAC,GAAG,EAAE,WAAW,EAAE;;IAIzB,MAAM,QAAQ,CAAC,KAAkB,EAAA;QAC/B,KAAK,CAAC,cAAc,EAAE;AACtB,QAAA,IAAI,CAAC,GAAG,CAAC,SAAS,CAAC,EAAE,IAAG;AACtB,YAAA,MAAM,QAAQ,GAAG,IAAI,QAAQ,CAAC,EAAE,CAAC;YACjC,IAAI,IAAI,GAAwB,EAAE;AAClC,YAAA,KAAK,MAAM,CAAC,GAAG,EAAE,KAAK,CAAC,IAAI,QAAQ,CAAC,OAAO,EAAE,EAAE;gBAC7C,IAAI,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE;oBAC5B,IAAI,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC;;AAChB,qBAAA,IAAI,IAAI,CAAC,GAAG,CAAC,EAAE;AACpB,oBAAA,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE,KAAK,CAAC;;qBACzB;AACL,oBAAA,IAAI,CAAC,GAAG,CAAC,GAAG,KAAK;;;AAGrB,YAAA,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC;AAC1B,SAAC,CAAC;;AAIJ,IAAA,SAAS,CAAC,KAAoB,EAAA;AAC5B,QAAA,IAAI,KAAK,CAAC,GAAG,KAAK,OAAO,EAAE;AACzB,YAAA,IAAI,CAAC,GAAG,CAAC,SAAS,CAAC,EAAE,IAAI,EAAE,CAAC,aAAa,CAAoB,qBAAqB,CAAC,EAAE,KAAK,EAAE,CAAC;;;AAIzF,IAAA,eAAe,GAAG,CAAC,EAAmB,KAAI;AAChD,QAAA,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE,CAAC;AACjB,QAAA,IAAI,CAAC,GAAG,CAAC,QAAQ,EAAE;AACrB,KAAC;IAED,MAAM,GAAA;AACJ,QAAA,QACE,CAAM,CAAA,MAAA,EAAA,EAAA,GAAA,EAAA,0CAAA,EAAA,GAAG,EAAE,IAAI,CAAC,eAAe,EAAA,EAC7B,CAAQ,CAAA,MAAA,EAAA,EAAA,GAAA,EAAA,0CAAA,EAAA,CAAA,CACH;;;;;;;;;;;;;;;;;;;;;;;","names":["JeForm","__stencil_proxyCustomElement","HTMLElement","AsyncSubject","switchMap","fromEvent","buffer","debounceTime"],"sources":["src/components/je-form/je-form.css?tag=je-form&encapsulation=scoped","src/components/je-form/je-form.tsx"],"sourcesContent":[":host {\n  display: contents;\n}\n\nform {\n  display: contents;\n}\n","import { Component, Event, EventEmitter, Listen, h } from '@stencil/core';\nimport { AsyncSubject, buffer, debounceTime, fromEvent, Subscription, switchMap } from 'rxjs';\n\n@Component({\n  tag: 'je-form',\n  styleUrl: 'je-form.css',\n  scoped: true\n})\nexport class JeForm {\n  private el$ = new AsyncSubject<HTMLFormElement>();\n  private sub?: Subscription;\n\n  @Event() formData: EventEmitter<Record<string, any>>;\n\n  connectedCallback() {\n    this.sub = this.el$.pipe(switchMap(el => {\n      const ev$ = fromEvent(el, 'invalid', { capture: true })\n      return ev$.pipe(buffer(ev$.pipe(debounceTime(100))))\n    })).subscribe(events => {\n      const firstInvalidElement = events[0].target as HTMLElement;\n      if (firstInvalidElement && !firstInvalidElement.matches(':focus'))\n        firstInvalidElement.focus();\n    });\n  }\n\n  disconnectedCallback() {\n    this.sub?.unsubscribe();\n  }\n\n  @Listen('submit')\n  async onSubmit(event: SubmitEvent) {\n    event.preventDefault();\n    this.el$.subscribe(el => {\n      const formData = new FormData(el);\n      let json: Record<string, any> = {};\n      for (const [key, value] of formData.entries()) {\n        if (Array.isArray(json[key])) {\n          json[key].push(value);\n        } else if (json[key]) {\n          json[key] = [json[key], value];\n        } else {\n          json[key] = value;\n        }\n      }\n      this.formData.emit(json);\n    })\n  }\n\n  @Listen('keydown')\n  onKeydown(event: KeyboardEvent) {\n    if (event.key === 'Enter') {\n      this.el$.subscribe(el => el.querySelector<HTMLButtonElement>('button[type=submit]')?.click())\n    }\n  }\n\n  private formElementInit = (el: HTMLFormElement) => {\n    this.el$.next(el);\n    this.el$.complete();\n  }\n\n  render() {\n    return (\n      <form ref={this.formElementInit}>\n        <slot />\n      </form>\n    );\n  }\n}\n"],"version":3}