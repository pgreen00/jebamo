{"file":"je-tooltip.js","mappings":"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","names":["JeTooltip","__stencil_proxyCustomElement","HTMLElement","AsyncSubject","fromEvent","debounceTime","map","switchMap","merge","debounce","tap"],"sources":["src/utils/get-dom-rect.ts","src/components/je-tooltip/je-tooltip.css?tag=je-tooltip&encapsulation=shadow","src/components/je-tooltip/je-tooltip.tsx"],"sourcesContent":["/**\n * Recursively gather bounding rectangles of all \"box-generating\" child nodes\n * inside an element (including its shadow root if it has one), flattening\n * any `display: contents` elements along the way.\n */\nfunction collectRects(element: Element): DOMRect[] {\n  if (!element) {\n    return [];\n  }\n\n  // The current list of rects from this element's children\n  let rects: DOMRect[] = [];\n\n  // Check if `element` itself generates a box, unless it's the top-level\n  // element for which we are collecting rects. Usually we skip\n  // the root since we want the sum of its children. But if you *do* want\n  // the host's box, you could do it here:\n  //\n  const cs = window.getComputedStyle(element);\n  if (cs.display !== 'contents') {\n    rects.push(element.getBoundingClientRect());\n  }\n\n  // Get direct child nodes (shadow or light DOM)\n  const childNodes = element.shadowRoot\n    ? Array.from(element.shadowRoot.children)\n    : Array.from(element.children);\n\n  childNodes.forEach((child) => {\n    if (\n      child.nodeType === Node.ELEMENT_NODE &&\n      !['STYLE', 'SCRIPT', 'LINK'].includes(child.tagName)\n    ) {\n      const computedStyle = window.getComputedStyle(child);\n\n      // If the element doesn't generate a box, flatten it by recursing\n      // into its children (or shadow children).\n      if (computedStyle.display === 'contents') {\n        rects = rects.concat(collectRects(child));\n      } else {\n        // Child *does* generate a box; use its bounding rect\n        rects.push(child.getBoundingClientRect());\n\n        // But also check if this child *itself* has a shadow root:\n        if ((child as HTMLElement).shadowRoot) {\n          rects = rects.concat(collectRects(child));\n        }\n      }\n    }\n  });\n\n  return rects;\n}\n\n/**\n * Return a bounding rect that encompasses all the\n * box-generating children (including across shadow roots).\n */\nexport function getDOMRect(element: Element) {\n  if (!element) {\n    return new DOMRect();\n  }\n\n  const rects = collectRects(element);\n\n  if (rects.length === 0) {\n    return new DOMRect();\n  }\n\n  const left = Math.min(...rects.map((r) => r.left));\n  const top = Math.min(...rects.map((r) => r.top));\n  const right = Math.max(...rects.map((r) => r.right));\n  const bottom = Math.max(...rects.map((r) => r.bottom));\n\n  return new DOMRect(left, top, right - left, bottom - top);\n}\n",":host {\n  display: contents;\n\n  --padding: var(--je-spacing-xs) var(--je-spacing-sm);\n  --background: light-dark(var(--je-neutral-950), var(--je-neutral-800));\n  --color: var(--je-neutral-300);\n  --border: none;\n  --radius: var(--je-radius-md);\n}\n\n[popover] {\n  opacity: 0;\n  transition: opacity 0.2s ease-in-out, display 0.2s ease-in-out allow-discrete;\n  box-shadow: var(--je-shadow-sm);\n  max-width: var(--available-width);\n  max-height: var(--available-height);\n  border-radius: var(--radius);\n  border: var(--border);\n  font-family: inherit;\n  background-color: var(--background);\n  color: var(--color);\n  box-sizing: border-box;\n  padding: var(--padding);\n  margin: 0;\n}\n\n[popover]:popover-open {\n  opacity: 1;\n}\n\n@starting-style {\n  [popover]:popover-open {\n    opacity: 0;\n  }\n}\n","import { autoUpdate, ComputePositionReturn, computePosition, offset, autoPlacement, size } from '@floating-ui/dom';\nimport { Component, Host, Prop, State, Watch, h, Element } from '@stencil/core';\nimport { AsyncSubject, Subscription, fromEvent, debounceTime, map, switchMap, merge, debounce, tap } from 'rxjs';\nimport { getDOMRect } from '../../utils/get-dom-rect';\n\n@Component({\n  tag: 'je-tooltip',\n  styleUrl: 'je-tooltip.css',\n  shadow: true,\n})\nexport class JeTooltip {\n  @Element() el!: HTMLElement;\n  @State() open = false;\n  private ready = new AsyncSubject<void>();\n  private sub?: Subscription;\n  private get containerEl() {\n    return this.el.shadowRoot.querySelector<HTMLSlotElement>('slot[name=content]');\n  }\n  private get referenceEl() {\n    return { getBoundingClientRect: () => getDOMRect(this.el.querySelector(':scope > :not([slot])')) }\n  }\n  private cleanup?: () => void;\n\n  /** The content of the tooltip */\n  @Prop() content?: string;\n\n  /** Horizontal offset used when auto positioning the popover content */\n  @Prop() offsetX = 0;\n\n  /** Vertical offset used when auto positioning the popover content */\n  @Prop() offsetY = 10;\n\n  componentDidLoad() {\n    this.ready.next();\n    this.ready.complete();\n  }\n\n  connectedCallback() {\n    const mouseMoveDebounce = fromEvent(window, 'mousemove').pipe(debounceTime(50));\n\n    this.sub = this.ready.pipe(\n      map(() => this.el.querySelector<HTMLElement>(':not([slot])')),\n      switchMap(triggerEl => merge(\n        fromEvent(triggerEl, 'mouseenter').pipe(map(() => 'enter' as const)),\n        fromEvent(triggerEl, 'mouseleave').pipe(map(() => 'leave' as const))\n      )),\n      debounce(() => mouseMoveDebounce)\n    ).subscribe(res => this.open = res == 'enter');\n\n    this.sub.add(this.ready.pipe(\n      tap(() => this.containerEl.popover = 'manual')\n    ).subscribe());\n  }\n\n  disconnectedCallback() {\n    this.sub?.unsubscribe();\n  }\n\n  @Watch('open')\n  async onOpenChange(open: boolean) {\n    if (open) {\n      this.setPosition(await this.computePosition());\n      this.cleanup = autoUpdate(this.referenceEl, this.containerEl, () => this.computePosition().then(this.setPosition));\n      this.containerEl.showPopover()\n    } else {\n      this.cleanup();\n      this.containerEl.hidePopover()\n    }\n  }\n\n  private setPosition = ({ x, y }: ComputePositionReturn) => {\n    this.containerEl.style.left = `${x}px`;\n    this.containerEl.style.top = `${y}px`;\n  }\n\n  private computePosition() {\n    return computePosition(this.referenceEl, this.containerEl, {\n      strategy: 'fixed',\n      middleware: [\n        offset({\n          mainAxis: this.offsetY,\n          crossAxis: this.offsetX,\n        }),\n        autoPlacement(),\n        size({\n          apply: ({ availableHeight, availableWidth }) => {\n            this.containerEl.style.setProperty('--available-height', `${availableHeight - this.offsetY}px`);\n            this.containerEl.style.setProperty('--available-width', `${availableWidth - this.offsetX}px`);\n          },\n        })\n      ]\n    })\n  }\n\n  render() {\n    return (\n      <Host role=\"tooltip\">\n        <slot />\n        <slot name='content'>\n          {this.content && <span>{this.content}</span>}\n        </slot>\n      </Host>\n    );\n  }\n}\n"],"version":3}